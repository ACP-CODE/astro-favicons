name: Publish Package

on:
  push:
    tags:
      - 'v*' # 只有在推送版本标签时触发发布流程

jobs:
  publish:
    runs-on: ubuntu-latest

    steps:
      # Step 1: 检出代码
      - name: Check out code
        uses: actions/checkout@v2

      # Step 2: 设置 Node.js 环境
      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18' # 使用 Node.js v18 或更高版本
          registry-url: 'https://registry.npmjs.org' # 指定 npm 注册表

      # Step 3: 清理 npm 缓存
      - name: Clean npm cache
        run: npm cache clean --force

      # Step 4: 安装依赖
      - name: Install dependencies
        run: npm install

      # Step 5: 构建项目（如果有构建步骤）
      - name: Build package
        run: npm run build # 如果有构建脚本，比如 TypeScript 项目

      # Step 6: 发布 npm 包
      - name: Publish package
        run: npm publish
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }} # 使用 GitHub Secrets 中的 npm token

      # Step 7: 显示发布完成消息
      - name: Notify success
        run: echo "Package published successfully!"
